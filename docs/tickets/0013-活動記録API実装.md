# 活動記録API実装

### ステータス

`Backlog`

### GitHub Copilot 対応: 可能

> API設計書を入力として、+server.ts / サービス層 / リポジトリ層の実装はCopilot対応可能

---

### 概要

活動記録の CRUD API を実装する。

### 背景・動機

子供が活動を記録し、履歴を確認するための基盤API。

### ゴール

- [ ] `src/routes/api/v1/activities/+server.ts` (GET, POST)
- [ ] `src/routes/api/v1/activities/[id]/+server.ts` (GET, PATCH, DELETE)
- [ ] `src/routes/api/v1/activity-logs/+server.ts` (GET, POST)
- [ ] `src/routes/api/v1/activity-logs/[id]/+server.ts` (DELETE)
- [ ] `$lib/server/services/activity-service.ts`
- [ ] `$lib/server/services/activity-log-service.ts`
- [ ] `$lib/server/db/activity-repo.ts`
- [ ] Zod バリデーションスキーマ
- [ ] **1日1回制限**: 同じ活動は同日に1回のみ記録可能（UNIQUE制約 + サービス層チェック）
- [ ] **ストリークボーナス**: 前日に同活動を記録していた場合、連続日数をカウントし `min(連続日数-1, 10)` の追加ポイントを付与
- [ ] **ALREADY_RECORDED エラー (409)**: 同日重複時に返却
- [ ] ユニットテスト（UT-LOG-01〜13, ストリーク含む）
- [ ] 統合テスト（API-LOG-01〜07）

### 作業メモ

- 活動記録のキャンセル（DELETE）は5秒以内のみ可能
- 子供別にフィルタリング可能であること
- `recorded_date` カラム（YYYY-MM-DD）で日次ユニーク制約を実現
- ストリーク計算: activity_logsテーブルから前日のrecorded_dateで同activity_idを検索
- レスポンスに `streakDays`, `streakBonus`, `totalPoints` を含める

### 成果・結果

### 残課題・次のアクション

