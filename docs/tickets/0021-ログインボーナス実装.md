# ログインボーナス実装

### ステータス

`Backlog`

### GitHub Copilot 対応: 部分的に可能

> API/サービス層の実装はCopilot対応可能。おみくじの確率ロジック、倍率計算はCopilot可能。UI演出部分（おみくじアニメーション）はClaude Codeが設計。

---

### 概要

子供がアプリにアクセスした際、1日1回おみくじ形式でボーナスポイントを付与するログインボーナス機能を実装する。

### 背景・動機

毎日のアプリ利用を動機付けるため、ガチャ/おみくじ的な射幸心を煽るゲーミフィケーション要素を導入する。連続ログインで倍率が上がる仕組みにより、継続利用も促進する。

### ゴール

- [ ] `login_bonuses` テーブル（DBスキーマ）
- [ ] `src/routes/api/v1/login-bonus/[childId]/+server.ts` (GET)
- [ ] `src/routes/api/v1/login-bonus/[childId]/claim/+server.ts` (POST)
- [ ] `$lib/server/services/login-bonus-service.ts`
  - [ ] おみくじランク抽選ロジック（重み付きランダム）
  - [ ] 連続ログイン日数計算
  - [ ] 連続ログイン倍率適用（3日:1.5x, 7日:2.0x, 14日:2.5x, 30日:3.0x）
  - [ ] ALREADY_CLAIMED エラー処理
- [ ] `$lib/server/db/login-bonus-repo.ts`
- [ ] 子供用ホーム画面でのおみくじ演出（Svelteコンポーネント）
  - [ ] おみくじ回転アニメーション
  - [ ] ランク別エフェクト（大大吉: 金色、大吉: 虹色）
  - [ ] 連続ログイン日数・倍率表示
- [ ] ユニットテスト（UT-LB-01〜08）
- [ ] 統合テスト（API-LB-01〜04）
- [ ] E2Eテスト（E2E-09）

### 作業メモ

- おみくじ確率: 大大吉1%, 大吉5%, 中吉15%, 小吉25%, 吉34%, 末吉20%
- `point_ledger` にも `login_bonus` タイプで記録すること
- ホーム画面のload関数で当日受取状態をチェックし、未受取ならおみくじ表示
- 参照: 04-要件定義書 F-06, 07-API設計書 §3.6, 08-DB設計書 login_bonuses, 06-UI設計書 §4.8

### 成果・結果

### 残課題・次のアクション

- 特別日ボーナス（誕生日、祝日等）は将来検討
