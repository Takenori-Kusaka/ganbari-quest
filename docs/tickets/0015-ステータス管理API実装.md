# ステータス管理API実装

### ステータス

`Done`

### GitHub Copilot 対応: 部分的に可能

> CRUD部分はCopilot対応可能。ステータス減少ロジック・市場比較ロジックはClaude Code主導。

---

### 概要

ステータス（能力値）の管理、減少ロジック、市場比較ロジックを実装する。

### 背景・動機

子供のステータスを可視化し、一般市場との比較による動機付けを行う核心機能。

### ゴール

- [x] `src/routes/api/v1/status/[childId]/+server.ts` (GET)
- [x] `$lib/server/services/status-service.ts`
- [x] `$lib/server/db/status-repo.ts`
- [x] `$lib/domain/validation/status.ts` (計算ロジック + Zodスキーマ)
- [x] ステータス計算ロジック（レベル・偏差値・星・キャラクタータイプ）
- [x] ステータス減少ロジック（年齢別係数 0.3/0.5/0.7/0.9、加速減少 0.05×N）
- [x] 市場比較データ参照ロジック（ベンチマークDB参照、偏差値計算）
- [x] レベルテーブル（10段階、称号付き）
- [x] ユニットテスト（ドメイン36件 + サービス10件 = 46件）

### 作業メモ

- 減少ロジック: 1日未活動→基礎減少(年齢係数×0.1)、2日以上→加速減少(+0.05×(N-1))
- 年齢係数: 0-6歳:0.3, 7-12歳:0.5, 13-18歳:0.7, 19歳以上:0.9
- 市場比較はmarket_benchmarksテーブルから取得。未設定時は偏差値50を返す
- ステータス値は0-100にクランプ

### 成果・結果

- ステータス取得API（レベル・偏差値・星・トレンド・キャラクター判定を含む）
- ステータス更新関数（週次評価から呼び出し用）
- ステータス減少計算関数（日次バッチ用）
- ドメインバリデーションテスト36件 + サービステスト10件（全パス）

### 残課題・次のアクション

- 日次バッチ（ステータス減少実行）は週次評価チケット(#0016)で統合
